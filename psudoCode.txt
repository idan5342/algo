create a new array of the following form:
[
    {
        time: item.StartTime
        type: "Start"
        ...item (without StopTime)
    },
    {
        time: item.StopTime
        type: "Stop"
        ...item (without StartTime)
    },
    ... (same for each item)
]

we will call this array Times

sort Times by time.

now we have the brackets problem with a little complication

make a empty array called Relevent.
create a new variable ActiveItem and set it to null.
make a new array (called Result) from Times by the following logic:
if (item.type === "start") {
    if (ActiveItem is null)
        ActiveItem = item
        ActiveItem.StartTime = item.time
        continue to the next item

    check level:
    if (item.level <= ActiveItem.level)
        Relevent.push(item)
        continue to the next item

    if (item.level > ActiveItem.level)
            Relevent.push(ActiveItem with StartTime = item.time)
            ActiveItem.StopTime = item.time
            Result.push(ActiveItem)
            ActiveItem = item
            ActiveItem.StartTime = item.time
            continue to the next item
} 
else (item.type === "stop") {
    check Relevent:
    if (ActiveItem.id === item.id) {
        ActiveItem.StopTime = item.time
        Result.push(ActiveItem)
        ActiveItem = null
        next = Relevant.extract_highest_level_that_is_still_active(item.time)
        if next exists:
            ActiveItem = next
            ActiveItem.StartTime = item.time
        continue
     else {
				find the matching item in Relevent
				make a full item and put it under owners of ActiveItem
				Relevent.remove(item)
    }
}